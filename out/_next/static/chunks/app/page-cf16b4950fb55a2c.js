(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8279:(e,t,n)=>{Promise.resolve().then(n.bind(n,946))},946:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P});var i=n(5155),o=n(2115),s=n(7665),r=n(3463),a=n(9795);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.QP)((0,r.$)(t))}let c=o.forwardRef((e,t)=>{let{className:n,children:o,...r}=e;return(0,i.jsxs)(s.bL,{ref:t,className:l("relative overflow-hidden",n),...r,children:[(0,i.jsx)(s.LM,{className:"h-full w-full rounded-[inherit]",children:o}),(0,i.jsx)(u,{}),(0,i.jsx)(s.OK,{})]})});c.displayName=s.bL.displayName;let u=o.forwardRef((e,t)=>{let{className:n,orientation:o="vertical",...r}=e;return(0,i.jsx)(s.VM,{ref:t,orientation:o,className:l("flex touch-none select-none transition-colors","vertical"===o&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===o&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",n),...r,children:(0,i.jsx)(s.lr,{className:"relative flex-1 rounded-full bg-border"})})});u.displayName=s.VM.displayName;var d=n(4920);let h=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,i.jsx)(d.bL,{ref:t,className:l("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...o})});h.displayName=d.bL.displayName;let g=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,i.jsx)(d._V,{ref:t,className:l("aspect-square h-full w-full",n),...o})});g.displayName=d._V.displayName;let m=o.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,i.jsx)(d.H4,{ref:t,className:l("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...o})});m.displayName=d.H4.displayName;var p=n(2317);let f=(0,n(1027).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),y=o.forwardRef((e,t)=>{let{className:n,variant:o,size:s,asChild:r=!1,...a}=e,c=r?p.DX:"button";return(0,i.jsx)(c,{className:l(f({variant:o,size:s,className:n})),ref:t,...a})});y.displayName="Button";var b=n(2655),v=n(5575),S=n(2926),x=n(4056);let w=new(n(4624)).ij("AIzaSyBjsa9ymf1ATCWSCWF_c6vkgr_tA2cOl8Q");class k{async transcribeAudio(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio/wav";try{return(await this.model.generateContent([{inlineData:{mimeType:t,data:e}},{text:"Please transcribe the spoken language in this audio accurately. Ignore any background noise or non-speech sounds."}])).response.text()}catch(e){throw console.error("Transcription error:",e),e}}constructor(){this.model=w.getGenerativeModel({model:"gemini-1.5-flash-8b"})}}let C="wss://".concat("generativelanguage.googleapis.com","/ws/google.ai.generativelanguage.v1alpha.GenerativeService.BidiGenerateContent?key=").concat("AIzaSyBjsa9ymf1ATCWSCWF_c6vkgr_tA2cOl8Q");class N{connect(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(console.log("[WebSocket] Attempting to connect to:",C),console.log("[WebSocket] Current voice state:",this.isVoiceEnabled),(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN){console.log("[WebSocket] Already connected, skipping connection");return}if((null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.CONNECTING){console.log("[WebSocket] Connection in progress, skipping connection");return}if(!n&&this.isSetupComplete){console.log("[WebSocket] Setup already complete, skipping connection");return}this.ws=new WebSocket(C),this.ws.onopen=()=>{console.log("[WebSocket] Connection established"),this.isConnected=!0,this.sendInitialSetup()},this.ws.onmessage=async e=>{try{let t;if(e.data instanceof Blob){let n=await e.data.arrayBuffer(),i=new Uint8Array(n);t=new TextDecoder("utf-8").decode(i)}else t=e.data;console.log("[WebSocket] Received message:",t),await this.handleMessage(t)}catch(e){console.error("[WebSocket] Error processing message:",e)}},this.ws.onerror=e=>{console.error("[WebSocket] Connection error:",e)},this.ws.onclose=e=>{console.log("[WebSocket] Connection closed:",e.code,e.reason),this.isConnected=!1,console.log("[WebSocket] Connection closed, not attempting to reconnect automatically")}}sendInitialSetup(){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.log("[WebSocket] Cannot send initial setup: WebSocket not open");return}console.log("[WebSocket] Sending initial setup with voice enabled:",this.isVoiceEnabled);let e={setup:{model:"models/gemini-2.0-flash-exp",generation_config:{response_modalities:this.isVoiceEnabled?["AUDIO"]:["TEXT"]},...this.isVoiceEnabled?{system_instruction:{parts:[{text:"請用英文回答."}]}}:{system_instruction:{parts:[{text:"You are an AI assistant in a meeting. Your role is to quietly listen to the conversation and only respond when needed. Rules: 1. DO NOT ask questions or take initiative. 2. DO NOT respond to greetings, simple confirmations, or small talk, such as asking your name. 3. ONLY respond when the speaker says something that: - Clearly asks for information or help - Involves a technical or complex question that likely needs expert assistance - Implies confusion or the speaker may need clarification 4. If no response is needed, return '...' 5. NEVER ask questions back to the speaker. You are only here to support quietly when necessary. 6. For screen-related questions: - If the user mentions anything about the screen, display, or visual content, respond with exactly '[SCREEN_REQUEST]' - After receiving the screen capture, analyze it and provide your answer 7. For non-screen questions, answer directly with audio. Remember: You are a silent assistant. Respond only when it truly helps. And don't ever ask any questions!!!"}]}}}};console.log("[WebSocket] Setup message:",e),this.ws.send(JSON.stringify(e)),this.isSetupComplete=!0,console.log("[WebSocket] Initial setup sent successfully")}reinitializeModel(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(console.log("[WebSocket] 當前模式: ".concat(this.isVoiceEnabled?"語音模式":"文字模式")),console.log("[WebSocket] 切換後模式: ".concat(e?"語音模式":"文字模式")),this.isVoiceEnabled===e&&!t){console.log("[WebSocket] 語音狀態未變化，跳過重新初始化");return}this.isVoiceEnabled=e,console.log("[WebSocket] 模型重新初始化，模式: ".concat(this.isVoiceEnabled?"語音模式":"文字模式")),this.disconnect(),setTimeout(()=>{this.connect(!0)},500)}sendMediaChunk(e,t){if(this.isConnected&&this.ws&&this.isSetupComplete)try{this.ws.send(JSON.stringify({realtime_input:{media_chunks:[{mime_type:"audio/pcm"===t?"audio/pcm":t,data:e}]}}))}catch(e){console.error("[WebSocket] Error sending media chunk:",e)}}async playAudioResponse(e){var t,n;console.log("[WebSocket] Playing audio response"),this.audioContext||(console.log("[WebSocket] Audio context not initialized, creating new one"),this.audioContext=new AudioContext);try{let n=atob(e),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);let o=await this.audioContext.decodeAudioData(i.buffer),s=this.audioContext.createBufferSource();s.buffer=o,s.connect(this.audioContext.destination),s.start(0),this.isPlaying=!0,null===(t=this.onPlayingStateChange)||void 0===t||t.call(this,!0);let r=this.audioContext.createAnalyser();r.fftSize=2048,s.connect(r);let a=new Uint8Array(r.frequencyBinCount),l=()=>{var e;if(!this.isPlaying)return;r.getByteFrequencyData(a);let t=a.reduce((e,t)=>e+t)/a.length,n=Math.min(100,t/128*100);null===(e=this.onAudioLevelChange)||void 0===e||e.call(this,n),requestAnimationFrame(l)};l(),s.onended=()=>{var e;this.isPlaying=!1,null===(e=this.onPlayingStateChange)||void 0===e||e.call(this,!1),s.disconnect(),r.disconnect()}}catch(e){console.error("[WebSocket] Error playing audio:",e),this.isPlaying=!1,null===(n=this.onPlayingStateChange)||void 0===n||n.call(this,!1)}}async playNextInQueue(){var e,t;if(console.log("[WebSocket] Playing next audio in queue"),!this.audioContext){console.log("[WebSocket] Audio context not initialized, cannot play audio");return}if(this.isPlaying){console.log("[WebSocket] Already playing audio, skipping");return}if(0===this.audioQueue.length){console.log("[WebSocket] Audio queue is empty, nothing to play");return}try{console.log("[WebSocket] Starting to play audio"),this.isPlaying=!0,this.isPlayingResponse=!0,null===(e=this.onPlayingStateChange)||void 0===e||e.call(this,!0);let t=this.audioQueue.shift(),n=this.audioContext.createBuffer(1,t.length,24e3);n.getChannelData(0).set(t),this.currentSource=this.audioContext.createBufferSource(),this.currentSource.buffer=n,this.currentSource.connect(this.audioContext.destination),this.currentSource.onended=()=>{if(console.log("[WebSocket] Audio playback ended"),this.isPlaying=!1,this.currentSource=null,0===this.audioQueue.length){var e;console.log("[WebSocket] Audio queue is empty, stopping response"),this.isPlayingResponse=!1,null===(e=this.onPlayingStateChange)||void 0===e||e.call(this,!1)}this.playNextInQueue()},console.log("[WebSocket] Starting audio playback"),this.currentSource.start()}catch(e){console.error("[WebSocket] Error playing audio:",e),this.isPlaying=!1,this.isPlayingResponse=!1,null===(t=this.onPlayingStateChange)||void 0===t||t.call(this,!1),this.currentSource=null,this.playNextInQueue()}}stopCurrentAudio(){var e;if(this.currentSource){try{this.currentSource.stop()}catch(e){}this.currentSource=null}this.isPlaying=!1,this.isPlayingResponse=!1,null===(e=this.onPlayingStateChange)||void 0===e||e.call(this,!1),this.audioQueue=[]}async handleMessage(e){try{var t,n,i,o,s,r,a;let l=JSON.parse(e);if(l.setupComplete){console.log("[WebSocket] Setup complete received"),console.log("[WebSocket] Current voice state:",this.isVoiceEnabled),this.isSetupComplete=!0,null===(o=this.onSetupCompleteCallback)||void 0===o||o.call(this);return}if(null===(n=l.serverContent)||void 0===n?void 0:null===(t=n.modelTurn)||void 0===t?void 0:t.parts)for(let e of l.serverContent.modelTurn.parts)(null===(s=e.inlineData)||void 0===s?void 0:s.mimeType)==="audio/pcm;rate=24000"?(console.log("[WebSocket] Received audio data"),this.accumulatedPcmData.push(e.inlineData.data),this.playAudioResponse(e.inlineData.data)):e.text&&(console.log("[WebSocket] Received text:",e.text),this.accumulatedText+=e.text);if((null===(i=l.serverContent)||void 0===i?void 0:i.turnComplete)===!0){if(console.log("[WebSocket] Turn complete received"),this.accumulatedPcmData.length>0)try{let e=this.accumulatedPcmData.join(""),t=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24e3;return new Promise((n,i)=>{try{let o=atob(e),s=new Uint8Array(o.length);for(let e=0;e<o.length;e++)s[e]=o.charCodeAt(e);let r=new Int16Array(s.buffer),a=new ArrayBuffer(44),l=new DataView(a),c=2*r.length;l.setUint8(0,82),l.setUint8(1,73),l.setUint8(2,70),l.setUint8(3,70),l.setUint32(4,36+c,!0),l.setUint8(8,87),l.setUint8(9,65),l.setUint8(10,86),l.setUint8(11,69),l.setUint8(12,102),l.setUint8(13,109),l.setUint8(14,116),l.setUint8(15,32),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,1,!0),l.setUint32(24,t,!0),l.setUint32(28,2*t,!0),l.setUint16(32,2,!0),l.setUint16(34,16,!0),l.setUint8(36,100),l.setUint8(37,97),l.setUint8(38,116),l.setUint8(39,97),l.setUint32(40,c,!0);let u=new ArrayBuffer(a.byteLength+c),d=new Uint8Array(u);d.set(new Uint8Array(a),0),d.set(new Uint8Array(r.buffer),a.byteLength);let h=new Blob([d],{type:"audio/wav"}),g=new FileReader;g.onloadend=()=>{var e;let t=null===(e=g.result)||void 0===e?void 0:e.toString().split(",")[1];t?n(t):i(Error("Failed to convert WAV to base64"))},g.onerror=i,g.readAsDataURL(h)}catch(e){i(e)}})}(e,24e3),n=await this.transcriptionService.transcribeAudio(t,"audio/wav");console.log("[Transcription]:",n),n&&"..."!==n&&(null===(r=this.onTranscriptionCallback)||void 0===r||r.call(this,n)),this.accumulatedPcmData=[]}catch(e){console.error("[WebSocket] Transcription error:",e)}this.accumulatedText&&"..."!==this.accumulatedText&&(null===(a=this.onMessageCallback)||void 0===a||a.call(this,this.accumulatedText)),this.accumulatedText=""}}catch(e){console.error("[WebSocket] Error parsing message:",e)}}disconnect(){if(console.log("[WebSocket] Disconnecting with voice enabled:",this.isVoiceEnabled),!this.ws){console.log("[WebSocket] No WebSocket connection to close");return}if(this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING){console.log("[WebSocket] WebSocket is not open or connecting, skipping disconnect");return}this.isSetupComplete=!1,console.log("[WebSocket] Closing WebSocket connection"),this.ws.close(1e3,"Intentional disconnect"),this.ws=null,this.isConnected=!1,this.accumulatedText="",this.accumulatedPcmData=[],console.log("[WebSocket] Disconnected successfully")}sendFollowUpRequest(e,t){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.error("[WebSocket] Cannot send follow-up request: WebSocket is not in OPEN state");return}this.sendMediaChunk(e,"image/jpeg");try{this.ws.send(JSON.stringify({realtime_input:{text:t}}))}catch(e){console.error("[WebSocket] Error sending follow-up request:",e)}}checkConnectionStatus(){var e;return this.isConnected&&(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}constructor(e,t,n,i,o){this.ws=null,this.isConnected=!1,this.isSetupComplete=!1,this.onMessageCallback=null,this.onSetupCompleteCallback=null,this.audioContext=null,this.audioQueue=[],this.isPlaying=!1,this.currentSource=null,this.isPlayingResponse=!1,this.onPlayingStateChange=null,this.onAudioLevelChange=null,this.onTranscriptionCallback=null,this.accumulatedText="",this.accumulatedPcmData=[],this.isVoiceEnabled=!1,this.onMessageCallback=e,this.onSetupCompleteCallback=t,this.onPlayingStateChange=n,this.onAudioLevelChange=i,this.onTranscriptionCallback=o,this.audioContext=new AudioContext({sampleRate:24e3}),this.transcriptionService=new k}}var W=n(3830);function E(e){let{onTranscription:t,isVoiceEnabled:n}=e,s=(0,o.useRef)(null),r=(0,o.useRef)(null),[a,l]=(0,o.useState)(!1),[c,u]=(0,o.useState)(null),[d,h]=(0,o.useState)(0),g=(0,o.useRef)(null),m=(0,o.useRef)(null),p=(0,o.useRef)(null),[f,w]=(0,o.useState)(!1),k=(0,o.useRef)(!1),[C,E]=(0,o.useState)(!1),j=(0,o.useRef)(null),[A,P]=(0,o.useState)(!1),[R,U]=(0,o.useState)(0),I=(0,o.useCallback)(()=>{p.current&&(p.current.disconnect(),p.current=null),r.current&&(r.current.close(),r.current=null)},[]),T=(0,o.useCallback)(()=>{g.current&&(g.current.disconnect(),g.current=null)},[]),V=e=>{g.current&&g.current.sendMediaChunk(e,"audio/pcm")},O=async()=>{if(a&&c)l(!1),T(),I(),c.getTracks().forEach(e=>e.stop()),s.current&&(s.current.srcObject=null),u(null);else try{let e=await navigator.permissions.query({name:"camera"});if("denied"===e.state)throw Error("Display capture permission denied");let t=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"monitor",frameRate:{ideal:30}},audio:!1}),n=await navigator.permissions.query({name:"microphone"});if("denied"===n.state)throw Error("Microphone permission denied");let i=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3,channelCount:1}});r.current&&"closed"!==r.current.state||(r.current=new AudioContext({sampleRate:16e3,latencyHint:"interactive"})),"suspended"===r.current.state&&await r.current.resume(),s.current&&(s.current.srcObject=t,s.current.muted=!0);let o=[...t.getVideoTracks(),...i.getAudioTracks()],c=new MediaStream(o);o.forEach(e=>{e.onended=()=>{console.log("Track ended:",e.kind),a&&O()}}),u(c),l(!0),console.log("Media streams initialized successfully:",{video:t.getVideoTracks().length>0,audio:i.getAudioTracks().length>0})}catch(e){console.error("Error accessing media devices:",e),e instanceof Error&&(console.error("Error name:",e.name),console.error("Error message:",e.message)),alert("Failed to access media devices. Please check your permissions and try again."),I()}};return(0,o.useEffect)(()=>{if(a)return g.current=new N(e=>{if(console.log("[CameraPreview] Received message:",e),e.includes("[SCREEN_REQUEST]")&&!n){console.log("[CameraPreview] Screen capture requested by model");let e=m.current;if(e&&s.current&&g.current){let t=e.getContext("2d");if(t){e.width=s.current.videoWidth,e.height=s.current.videoHeight,t.drawImage(s.current,0,0);let n=e.toDataURL("image/jpeg",.8).split(",")[1];g.current.sendMediaChunk(n,"image/jpeg"),g.current.sendFollowUpRequest(n,"")}}return}"..."!==e&&t(e)},()=>{console.log("[Camera] WebSocket setup complete, starting media capture"),E(!0)},e=>{P(e)},e=>{U(e)},t),g.current.connect(),()=>{j.current&&(clearInterval(j.current),j.current=null),T(),E(!1)}},[a,t,T,n]),(0,o.useEffect)(()=>{var e;if(console.log("[Camera] Voice state changed:",n),!a){console.log("[Camera] Not streaming, skipping reinitialization");return}if(!g.current){console.log("[Camera] WebSocket not initialized, skipping reinitialization");return}if(!C){console.log("[Camera] WebSocket not ready, skipping reinitialization");return}let t=(null===(e=window.event)||void 0===e?void 0:e.type)==="voiceStateChanged";console.log("[Camera] Reinitializing model with voice enabled:",n),g.current.reinitializeModel(n,t)},[n,a,C]),(0,o.useEffect)(()=>{if(!a||!C||!n){j.current&&(clearInterval(j.current),j.current=null);return}return console.log("[Camera] Starting automatic screen capture in audio mode"),j.current=setInterval(()=>{if(!s.current||!m.current||!g.current)return;let e=m.current,t=e.getContext("2d");if(!t)return;e.width=s.current.videoWidth,e.height=s.current.videoHeight,t.drawImage(s.current,0,0);let n=e.toDataURL("image/jpeg",.8).split(",")[1];g.current.sendMediaChunk(n,"image/jpeg")},3e3),()=>{j.current&&(clearInterval(j.current),j.current=null)}},[a,C,n]),(0,o.useEffect)(()=>{if(a&&C)return console.log("[Camera] WebSocket ready, waiting for screen capture requests"),()=>{j.current&&(clearInterval(j.current),j.current=null)}},[a,C]),(0,o.useEffect)(()=>{if(!a||!c||!r.current||!C||f||k.current)return;let e=!0;k.current=!0;let t=async()=>{try{let t=r.current;if(!t||"closed"===t.state||!e||("suspended"===t.state&&await t.resume(),await t.audioWorklet.addModule("/worklets/audio-processor.js"),!e)){k.current=!1;return}p.current=new AudioWorkletNode(t,"audio-processor",{numberOfInputs:1,numberOfOutputs:1,processorOptions:{sampleRate:16e3,bufferSize:4096},channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers"});let n=t.createMediaStreamSource(c);return p.current.port.onmessage=t=>{var n;if(!e||A||!(null===(n=g.current)||void 0===n?void 0:n.checkConnectionStatus()))return;let{pcmData:i,level:o}=t.data;h(o);let s=new Uint8Array(i),r=W.o4.fromUint8Array(s);V(r)},n.connect(p.current),w(!0),k.current=!1,()=>{n.disconnect(),p.current&&p.current.disconnect(),w(!1)}}catch(t){e&&(I(),w(!1)),k.current=!1}};return console.log("[Camera] Starting audio processing setup"),t(),()=>{e=!1,w(!1),k.current=!1,p.current&&(p.current.disconnect(),p.current=null)}},[a,c,C,A,I,f]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("video",{ref:s,autoPlay:!0,playsInline:!0,className:"hidden"}),(0,i.jsx)("canvas",{ref:m,className:"hidden"}),a&&(0,i.jsx)("div",{className:"w-full h-1 rounded-full bg-green-100 mt-2",children:(0,i.jsx)("div",{className:"h-full rounded-full transition-all bg-green-500",style:{width:"".concat(A?R:d,"%"),transition:"width 100ms ease-out"}})}),(0,i.jsxs)("div",{className:"flex justify-center gap-2 mt-2",children:[(0,i.jsx)(y,{onClick:O,size:"icon",className:"rounded-full w-10 h-10\n            ".concat(a?"bg-red-500 hover:bg-red-600 text-white":"bg-green-500 hover:bg-green-600 text-white"),children:a?(0,i.jsx)(b.A,{className:"h-5 w-5"}):(0,i.jsx)(v.A,{className:"h-5 w-5"})}),(0,i.jsx)(y,{onClick:()=>{let e=new CustomEvent("toggleVoice");window.dispatchEvent(e)},size:"icon",className:"rounded-full w-10 h-10\n            ".concat(n?"bg-red-500 hover:bg-red-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-600"),children:n?(0,i.jsx)(S.A,{className:"h-5 w-5"}):(0,i.jsx)(x.A,{className:"h-5 w-5"})})]})]})}let j=e=>{let{text:t}=e;return(0,i.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,i.jsxs)(h,{className:"h-8 w-8",children:[(0,i.jsx)(g,{src:"/avatars/human.png",alt:"Human"}),(0,i.jsx)(m,{children:"H"})]}),(0,i.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsx)("p",{className:"text-sm font-medium text-zinc-900",children:"You"})}),(0,i.jsx)("div",{className:"rounded-lg bg-zinc-100 px-3 py-2 text-sm text-zinc-800",children:t})]})]})},A=e=>{let{text:t}=e;return(0,i.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,i.jsxs)(h,{className:"h-8 w-8 bg-blue-600",children:[(0,i.jsx)(g,{src:"/avatars/gemini.png",alt:"Gemini"}),(0,i.jsx)(m,{children:"AI"})]}),(0,i.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsx)("p",{className:"text-sm font-medium text-zinc-900",children:"Gemini"})}),(0,i.jsx)("div",{className:"rounded-lg bg-white border border-zinc-200 px-3 py-2 text-sm text-zinc-800",children:t})]})]})};function P(){let[e,t]=(0,o.useState)([]),[n,s]=(0,o.useState)(!1),r=(0,o.useRef)(!1);(0,o.useEffect)(()=>{console.log("[Voice] 強制設置為文字模式"),s(!1),r.current=!1,localStorage.setItem("isVoiceEnabled",JSON.stringify(!1))},[]),(0,o.useEffect)(()=>{localStorage.setItem("isVoiceEnabled",JSON.stringify(n)),r.current=n},[n]),(0,o.useEffect)(()=>{console.log("AI Meeting Assistant initialized"),console.log("Voice mode:",n?"enabled":"disabled")},[n]);let a=(0,o.useCallback)(e=>{t(t=>[...t,{type:"gemini",text:e}])},[]),l=()=>{let e=!r.current;console.log("[Voice] 當前模式: ".concat(r.current?"語音模式":"文字模式")),console.log("[Voice] 切換後模式: ".concat(e?"語音模式":"文字模式")),s(e),r.current=e,localStorage.setItem("isVoiceEnabled",JSON.stringify(e)),console.log("[Voice] 已保存到 localStorage: ".concat(e?"語音模式":"文字模式"));let t=new CustomEvent("voiceStateChanged",{detail:{isVoiceEnabled:e,timestamp:Date.now()}});window.dispatchEvent(t)};return(0,o.useEffect)(()=>{let e=()=>{l()};return window.addEventListener("toggleVoice",e),()=>{window.removeEventListener("toggleVoice",e)}},[]),(0,i.jsxs)("div",{className:"w-[400px] h-[500px] bg-white rounded-lg shadow-lg p-4 flex flex-col",children:[(0,i.jsxs)("div",{className:"flex items-center justify-center mb-4",children:[(0,i.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-2",children:(0,i.jsx)("span",{className:"text-white font-bold text-lg",children:"AI"})}),(0,i.jsx)("h1",{className:"text-lg font-semibold text-gray-800",children:"AI Meeting Assistant"})]}),(0,i.jsx)(E,{onTranscription:a,isVoiceEnabled:n}),(0,i.jsx)(c,{className:"flex-1 p-4",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(A,{text:"Hi! I'm Gemini. I can see and hear you. Let's chat!"}),e.map((e,t)=>"human"===e.type?(0,i.jsx)(j,{text:e.text},"msg-".concat(t)):(0,i.jsx)(A,{text:e.text},"msg-".concat(t)))]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[972,441,517,358],()=>t(8279)),_N_E=e.O()}]);